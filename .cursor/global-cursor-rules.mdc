---
alwaysApply: true
---
# 예약 플랫폼 프로젝트

## 프로젝트 개요
예약 시스템을 제공하는 웹 애플리케이션입니다. 고객은 상품(예: 스터디룸, 회의실 등)을 검색하고 예약할 수 있으며, 관리자는 상품 관리 및 예약 관리를 할 수 있습니다.

## 디렉토리 구조

```
src/
├── app/
│   ├── (auth)/                    # 인증 관련 페이지 그룹
│   │   ├── login/                 # 로그인 페이지
│   │   │   └── page.tsx
│   │   └── register/              # 회원가입 페이지
│   │       └── page.tsx
│   ├── (main)/                    # 메인 고객 페이지 그룹
│   │   ├── page.tsx              # 메인(인덱스) 페이지
│   │   ├── products/             # 상품 관련
│   │   │   ├── page.tsx          # 상품 리스트
│   │   │   └── [id]/             # 상품 상세
│   │   │       └── page.tsx
│   │   ├── reservation/          # 예약 관련
│   │   │   └── [id]/             # 예약 페이지 (캘린더)
│   │   │       └── page.tsx
│   │   └── payment/              # 결제 페이지
│   │       └── page.tsx
│   └── admin/                    # 관리자 페이지
│       ├── layout.tsx            # 관리자 레이아웃
│       ├── page.tsx              # 대시보드 메인
│       ├── products/             # 상품 관리
│       │   ├── page.tsx          # 상품 목록
│       │   ├── new/              # 상품 등록
│       │   │   └── page.tsx
│       │   └── [id]/             # 상품 수정
│       │       └── page.tsx
│       ├── reservations/         # 예약 관리
│       │   └── page.tsx          # 예약 승인 관리
│       ├── payments/             # 결제 관리
│       │   └── page.tsx
│       └── statistics/           # 통계
│           └── page.tsx          # 매출 및 예약 통계
├── components/
│   ├── ui/                       # shadcn/ui 컴포넌트
│   ├── layout/                   # 레이아웃 컴포넌트
│   │   ├── Header.tsx
│   │   ├── Footer.tsx
│   │   └── Sidebar.tsx
│   ├── products/                 # 상품 관련 컴포넌트
│   │   ├── ProductCard.tsx
│   │   ├── ProductList.tsx
│   │   └── ProductForm.tsx
│   ├── reservation/              # 예약 관련 컴포넌트
│   │   ├── Calendar.tsx
│   │   ├── TimeSlot.tsx
│   │   └── ReservationForm.tsx
│   └── admin/                    # 관리자 컴포넌트
│       ├── DashboardCard.tsx
│       ├── ReservationList.tsx
│       └── StatisticsChart.tsx
├── lib/
│   ├── utils.ts                  # 유틸리티 함수
│   ├── auth.ts                   # 인증 함수 (Supabase Auth)
│   ├── supabase/
│   │   ├── client.ts            # 브라우저용 클라이언트
│   │   ├── server.ts            # 서버용 클라이언트
│   │   └── middleware.ts        # 미들웨어 헬퍼
│   └── api/
│       ├── products.ts          # 상품 API 함수
│       ├── reservations.ts      # 예약 API 함수
│       └── payments.ts          # 결제 API 함수
├── types/
│   ├── supabase.ts               # Supabase 데이터베이스 타입
│   ├── database.ts               # 타입 유틸리티
│   ├── user.ts                   # 사용자 타입 (legacy)
│   ├── product.ts                # 상품 타입 (legacy)
│   ├── reservation.ts            # 예약 타입 (legacy)
│   └── payment.ts                # 결제 타입 (legacy)
└── api/                          # API 라우트 (또는 app/api/)
    ├── auth/
    │   ├── login/
    │   └── register/
    ├── products/
    ├── reservations/
    └── payments/
```

## 데이터 모델

### User (사용자)
```typescript
interface User {
  id: string;                     // 사용자 고유 ID
  email: string;                  // 이메일 (로그인 ID)
  password: string;               // 암호화된 비밀번호
  name: string;                   // 사용자 이름
  phone: string;                  // 전화번호
  role: 'customer' | 'admin';     // 역할 (고객/관리자)
  createdAt: Date;                // 생성일
  updatedAt: Date;                // 수정일
}
```

### Product (상품)
```typescript
interface Product {
  id: string;                     // 상품 고유 ID
  name: string;                   // 상품명 (예: 스터디 룸 A)
  description: string;            // 상품 설명
  images: string[];               // 이미지 URL 배열
  category: string;               // 카테고리 (예: 스터디룸, 회의실)
  pricePerHour: number;           // 시간당 가격
  capacity: number;               // 최대 수용 인원
  location: string;               // 위치
  amenities: string[];            // 편의시설 (예: 화이트보드, 프로젝터)
  availableTimeSlots: {           // 예약 가능 시간대
    dayOfWeek: number;            // 0(일요일) ~ 6(토요일)
    startTime: string;            // 시작 시간 (HH:mm)
    endTime: string;              // 종료 시간 (HH:mm)
  }[];
  status: 'active' | 'inactive';  // 상태 (활성/비활성)
  createdAt: Date;                // 생성일
  updatedAt: Date;                // 수정일
}
```

### Reservation (예약)
```typescript
interface Reservation {
  id: string;                     // 예약 고유 ID
  productId: string;              // 상품 ID (FK)
  userId: string;                 // 사용자 ID (FK)
  reservationDate: Date;          // 예약 날짜
  startTime: string;              // 시작 시간 (HH:mm)
  endTime: string;                // 종료 시간 (HH:mm)
  numberOfPeople: number;         // 인원 수
  totalPrice: number;             // 총 가격
  status: 'pending' | 'confirmed' | 'cancelled' | 'completed';  // 예약 상태
  specialRequests?: string;       // 특별 요청사항
  createdAt: Date;                // 생성일
  updatedAt: Date;                // 수정일
}
```

### Payment (결제)
```typescript
interface Payment {
  id: string;                     // 결제 고유 ID
  reservationId: string;          // 예약 ID (FK)
  userId: string;                 // 사용자 ID (FK)
  amount: number;                 // 결제 금액
  paymentMethod: 'card' | 'transfer' | 'kakao' | 'toss';  // 결제 수단
  paymentStatus: 'pending' | 'completed' | 'failed' | 'refunded';  // 결제 상태
  transactionId?: string;         // 결제 거래 ID (PG사)
  paidAt?: Date;                  // 결제 완료 시각
  refundedAt?: Date;              // 환불 시각
  createdAt: Date;                // 생성일
  updatedAt: Date;                // 수정일
}
```

### ReservationWithDetails (조인된 예약 정보)
```typescript
interface ReservationWithDetails extends Reservation {
  product: Product;               // 상품 정보
  user: {                         // 사용자 기본 정보
    id: string;
    name: string;
    email: string;
    phone: string;
  };
  payment?: Payment;              // 결제 정보
}
```

### Statistics (통계)
```typescript
interface Statistics {
  totalRevenue: number;           // 총 매출
  totalReservations: number;      // 총 예약 수
  todayReservations: number;      // 오늘의 예약
  weekReservations: number;       // 이번 주 예약
  pendingReservations: number;    // 대기 중 예약
  revenueByMonth: {               // 월별 매출
    month: string;                // YYYY-MM
    revenue: number;
  }[];
  popularProducts: {              // 인기 상품
    productId: string;
    productName: string;
    reservationCount: number;
  }[];
}
```

## 기술 스택
- **Framework**: Next.js 14+ (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **UI Components**: shadcn/ui
- **State Management**: React Context API / Zustand
- **Form Validation**: React Hook Form + Zod
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Payment**: 토스페이먼츠 / 카카오페이
- **Calendar**: react-calendar 또는 date-fns

## Supabase 연동 정보

### 설치된 패키지
- `@supabase/supabase-js`: Supabase JavaScript 클라이언트
- `@supabase/ssr`: Next.js App Router를 위한 SSR 헬퍼

### 클라이언트 파일 위치
- `src/lib/supabase/client.ts`: 브라우저용 클라이언트 (Client Components)
- `src/lib/supabase/server.ts`: 서버용 클라이언트 (Server Components, Server Actions)
- `src/lib/supabase/middleware.ts`: 미들웨어 헬퍼 함수

### API 함수 위치
- `src/lib/api/products.ts`: 상품 CRUD 함수
- `src/lib/api/reservations.ts`: 예약 CRUD 함수
- `src/lib/api/payments.ts`: 결제 CRUD 함수
- `src/lib/auth.ts`: 인증 관련 함수 (회원가입, 로그인, 로그아웃)

### 타입 정의
- `src/types/supabase.ts`: Supabase 데이터베이스 타입
- `src/types/database.ts`: 애플리케이션용 타입 유틸리티

### SQL 마이그레이션
- `supabase/migrations/001_create_tables.sql`: 테이블 생성
- `supabase/migrations/002_row_level_security.sql`: RLS 정책 설정
- `supabase/migrations/003_seed_data.sql`: 테스트 데이터

### 환경 변수
```bash
NEXT_PUBLIC_SUPABASE_URL=your-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

### 사용 예제

#### Server Component에서 데이터 조회
```typescript
import { createServerSupabaseClient } from '@/lib/supabase/server'

const supabase = await createServerSupabaseClient()
const { data, error } = await supabase.from('products').select('*')
```

#### Client Component에서 데이터 조회
```typescript
import { getProducts } from '@/lib/api/products'

const products = await getProducts()
```

#### 인증
```typescript
import { signUp, signIn, signOut } from '@/lib/auth'

// 회원가입
await signUp(email, password, name, phone)

// 로그인
await signIn(email, password)

// 로그아웃
await signOut()
```

### 보안 규칙
- Row Level Security (RLS) 활성화됨
- 사용자는 자신의 데이터만 접근 가능
- 관리자는 모든 데이터 접근 가능
- `service_role key`는 서버 사이드에서만 사용

## 주요 기능

### 고객 기능
1. **메인 페이지**: 인기 상품, 최신 상품 표시
2. **회원가입/로그인**: 이메일 기반 인증
3. **상품 리스트**: 필터링, 검색, 정렬 기능
4. **상품 상세**: 상품 정보, 리뷰, 예약 버튼
5. **예약 페이지**: 캘린더로 날짜 선택, 시간대 선택, 인원 입력
6. **결제 페이지**: 결제 수단 선택 및 결제 처리

### 관리자 기능
1. **상품 등록**: 상품 정보, 이미지, 가격, 시간대 설정
2. **상품 관리**: 상품 수정, 삭제, 활성화/비활성화
3. **예약 승인 관리**: 예약 목록, 승인/거절/취소
4. **결제 관리**: 결제 내역, 환불 처리
5. **통계 대시보드**: 매출 통계, 예약 통계, 그래프

## API 엔드포인트

### 인증
- `POST /api/auth/register` - 회원가입
- `POST /api/auth/login` - 로그인
- `POST /api/auth/logout` - 로그아웃

### 상품
- `GET /api/products` - 상품 목록 조회
- `GET /api/products/:id` - 상품 상세 조회
- `POST /api/products` - 상품 등록 (관리자)
- `PUT /api/products/:id` - 상품 수정 (관리자)
- `DELETE /api/products/:id` - 상품 삭제 (관리자)

### 예약
- `GET /api/reservations` - 예약 목록 조회
- `GET /api/reservations/:id` - 예약 상세 조회
- `POST /api/reservations` - 예약 생성
- `PUT /api/reservations/:id` - 예약 수정
- `PATCH /api/reservations/:id/status` - 예약 상태 변경 (관리자)
- `DELETE /api/reservations/:id` - 예약 취소

### 결제
- `POST /api/payments` - 결제 생성
- `POST /api/payments/:id/confirm` - 결제 확인
- `POST /api/payments/:id/refund` - 환불 처리 (관리자)

### 통계
- `GET /api/admin/statistics` - 통계 데이터 조회 (관리자)

## 코딩 컨벤션
- 파일명: PascalCase for components, camelCase for utilities
- 컴포넌트: 함수형 컴포넌트 사용
- 타입: interface 우선, type은 유니온/인터섹션에만 사용
- API: RESTful 패턴 준수
- 에러 처리: try-catch 블록과 적절한 에러 메시지
- 주석: JSDoc 스타일로 함수/컴포넌트 설명
