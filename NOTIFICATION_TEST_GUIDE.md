# 실시간 알림 시스템 테스트 가이드

## 🧪 빠른 테스트 방법

### 1단계: 개발 서버 실행

```bash
npm run dev
```

### 2단계: 관리자 페이지 열기

**브라우저 1 (일반 모드)**
```
http://localhost:3000/admin
```

- 관리자 계정으로 로그인
- 우측 상단에 알림 아이콘(🔔) 확인
- 우측 하단에 "실시간 연결됨" 상태 확인 (개발 모드에서만 표시)

### 3단계: 사용자 예약 진행

**브라우저 2 (시크릿 모드)**
```
http://localhost:3000/products
```

1. 일반 사용자로 로그인 (또는 회원가입)
2. 원하는 공간 선택
3. 날짜, 시간, 인원 선택
4. "예약하기" 클릭
5. 결제 진행 및 완료

### 4단계: 관리자 페이지에서 알림 확인

**브라우저 1로 돌아가기**

결제가 완료되면 즉시:

1. ✅ **Toast 알림** 우측 상단에 표시
   - 제목: "새로운 예약이 확정되었습니다"
   - 메시지: "{상품명}에 대한 예약이 결제 완료되었습니다."
   - "확인" 버튼 클릭 시 알림 페이지로 이동

2. ✅ **알림 소리** 재생
   - 두 번의 비프음 (800Hz → 1000Hz)

3. ✅ **브라우저 알림** (권한이 허용된 경우)
   - 시스템 알림으로 표시

4. ✅ **알림 아이콘 배지** 업데이트
   - 빨간색 숫자 배지 표시
   - 애니메이션 효과

### 5단계: 알림 페이지 확인

알림 아이콘 클릭 → `/admin/notifications` 페이지로 이동

확인 사항:
- ✅ 새로운 알림이 목록 최상단에 표시
- ✅ 읽지 않은 알림은 파란색 테두리
- ✅ 알림 상세 정보 표시
  - 상품명
  - 고객 이메일
  - 예약 날짜
  - 시간 (시작~종료)
  - 금액
- ✅ "예약 보기" 버튼으로 예약 관리 페이지 이동 가능

## 🎯 테스트 체크리스트

### 실시간 알림 기능

- [ ] 결제 완료 시 즉시 Toast 알림 표시
- [ ] 알림 소리 재생 (두 번의 비프음)
- [ ] 브라우저 네이티브 알림 표시
- [ ] 알림 아이콘 배지 숫자 증가
- [ ] 알림 목록에 새 알림 추가

### 알림 페이지 기능

- [ ] 알림 목록 표시
- [ ] 읽지 않은 알림 강조 표시
- [ ] 필터 기능 (전체/읽지 않음/읽음)
- [ ] 개별 읽음 처리
- [ ] 모두 읽음 처리
- [ ] 알림 삭제
- [ ] 예약 상세 페이지로 이동

### 실시간 동기화

- [ ] 여러 브라우저 탭에서 동시에 알림 수신
- [ ] 읽음 처리 시 모든 탭에서 배지 숫자 감소
- [ ] 알림 삭제 시 모든 탭에서 제거

## 🔍 디버깅 방법

### 1. Realtime 연결 상태 확인

개발 모드에서 우측 하단에 연결 상태 표시:
- 🟢 "실시간 연결됨" - 정상
- 🔴 "연결 끊김" - 문제 발생

### 2. 브라우저 콘솔 확인

```javascript
// F12 → Console 탭

// Realtime 연결 로그
"Realtime subscription connected"

// 알림 수신 로그
// (새 알림이 오면 자동으로 표시됨)
```

### 3. Supabase 대시보드 확인

1. Supabase 대시보드 접속
2. Database → Replication 확인
3. `notifications` 테이블이 활성화되어 있는지 확인

### 4. 네트워크 탭 확인

F12 → Network 탭:
- WebSocket 연결 확인
- `wss://` 로 시작하는 연결이 있어야 함

## 🐛 문제 해결

### 알림이 오지 않는 경우

**원인 1: Realtime이 활성화되지 않음**
```sql
-- Supabase SQL Editor에서 실행
ALTER PUBLICATION supabase_realtime ADD TABLE notifications;
```

**원인 2: RLS 정책 문제**
- 관리자 계정의 `role` 필드가 'admin'인지 확인
- `users` 테이블에서 확인:
  ```sql
  SELECT id, email, role FROM users WHERE role = 'admin';
  ```

**원인 3: 브라우저 캐시**
- 하드 리프레시: `Ctrl + Shift + R` (Windows) 또는 `Cmd + Shift + R` (Mac)
- 또는 시크릿 모드로 테스트

### 소리가 재생되지 않는 경우

**원인: 브라우저 자동재생 정책**
- 사용자 상호작용 후에만 소리 재생 가능
- 페이지 로드 후 아무 곳이나 클릭한 후 테스트

**해결 방법:**
1. 페이지 접속
2. 아무 버튼이나 클릭
3. 알림 테스트 진행

### 브라우저 알림이 표시되지 않는 경우

**원인: 알림 권한 거부**

**해결 방법:**
1. 브라우저 주소창 왼쪽의 자물쇠 아이콘 클릭
2. "알림" 권한을 "허용"으로 변경
3. 페이지 새로고침

## 📊 성능 테스트

### 다중 알림 테스트

1. 여러 사용자가 동시에 예약 진행
2. 관리자 페이지에서 모든 알림이 순차적으로 표시되는지 확인
3. 배지 숫자가 정확하게 증가하는지 확인

### 장시간 연결 테스트

1. 관리자 페이지를 1시간 이상 열어둠
2. 중간에 예약 진행
3. 여전히 알림이 정상적으로 오는지 확인

### 네트워크 재연결 테스트

1. 관리자 페이지 열기
2. 네트워크 연결 끊기 (Wi-Fi 끄기)
3. 네트워크 연결 복구
4. 우측 하단 상태가 "실시간 연결됨"으로 변경되는지 확인

## 🎉 테스트 완료!

모든 체크리스트를 통과했다면 실시간 알림 시스템이 정상적으로 작동하는 것입니다!

## 📝 추가 테스트 시나리오

### 시나리오 1: 연속 예약

1. 사용자 A가 예약 완료
2. 즉시 사용자 B가 예약 완료
3. 관리자 페이지에서 두 알림이 모두 표시되는지 확인

### 시나리오 2: 읽음 처리 동기화

1. 브라우저 탭 2개로 관리자 페이지 열기
2. 탭 1에서 알림 읽음 처리
3. 탭 2에서도 배지 숫자가 감소하는지 확인

### 시나리오 3: 알림 삭제 동기화

1. 브라우저 탭 2개로 알림 페이지 열기
2. 탭 1에서 알림 삭제
3. 탭 2에서도 알림이 사라지는지 확인

## 🔗 관련 문서

- [REALTIME_NOTIFICATION_GUIDE.md](./REALTIME_NOTIFICATION_GUIDE.md) - 상세 시스템 가이드
- [Supabase Realtime 공식 문서](https://supabase.com/docs/guides/realtime)
